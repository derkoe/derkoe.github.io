<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Development Environment in WSL2</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel=stylesheet><link rel=stylesheet href=https://derkoe.github.io/css/bundle.min.4575e29036d0142f6031580daa21a4d778d9c20463b8bdc7457eedf7869a0ced.css></head><body><header><nav class=home-menu><a href=https://derkoe.github.io/ class=menu-heading>Christian KÃ¶berl</a><ul><li><a href=/about/>About</a></li><li><a href=/talks/>Talks</a></li></ul></nav></header><main><article class="container mt-4 post"><h1>Development Environment in WSL2</h1><p>This guide shows how to setup a full development environment including UI apps (X11) in WSL2 on Windows 10. WSL2 enables a &ldquo;full&rdquo; Linux development environment in Windows.</p><p>This article is still a work in progress - unfinished sections are marked with TODO.</p><h2 id=why>Why?</h2><p>The first thing you might ask is: why? First, we have to run Windows on our machines - so the all-in Linux does not work. Second, Linux is a lot faster for building software than Windows - our biggest app compiles in 13 minutes under Windows and in just 2 minutes under WSL on my machine which is a massive improvement.</p><h2 id=enable-wsl2-and-install-ubuntu>Enable WSL2 and Install Ubuntu</h2><p>For WSL2 to work you will need a Windows 10 build 19041 (aka 20H1) or higher (any edition will work, even Home). Then simply follow the <a href=https://docs.microsoft.com/en-us/windows/wsl/wsl2-install title="Windows Subsystem for Linux Installation Guide for Windows 10">guide from Microsoft</a>.</p><p><strong>TL;DR:</strong></p><ol><li>Enable the features WSL and VM-Platform in Powershell as Admin:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre></div></li><li>Restart Windows</li><li>Set WSL2 as default:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>wsl --set-default-version 2
</code></pre></div></li><li>Go to the Microsoft Store and install &ldquo;Ubuntu&rdquo;</li><li>Launch Ubuntu from Start menu (this will ask you for a user account)</li></ol><p>You can now re-launch a shell in your Ubuntu instance with &ldquo;Ubuntu&rdquo; from the Start menu or execute <code>wsl</code> from the command line. The WSL command line tool has many options which you can find with <code>wsl --help</code> or in the <a href=https://docs.microsoft.com/en-us/windows/wsl/reference>Command Reference</a>.</p><h2 id=update-and-install-software>Update and Install Software</h2><p>Inside your Ubuntu Linux update all packages:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt update
sudo apt upgrade
</code></pre></div><p>Then install packages you need for your development - in my case it is Java 11, Maven, Node.js/NPM and git:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt install openjdk-11-jdk openjdk-11-source maven nodejs npm git
</code></pre></div><p>Do not install Docker CLI or Docker Compose because these are provided by Docker Desktop (see next section).</p><h2 id=install-docker-optional>Install Docker (optional)</h2><p>Most developers need Docker for their local setup - the newest Docker Desktop version supports WSL2 out of the box (even on Windows Home).</p><h2 id=gui-apps>GUI Apps</h2><p>Currently there is no support for GUI apps for WSL - Microsoft has <a href=https://devblogs.microsoft.com/commandline/the-windows-subsystem-for-linux-build-2020-summary/#wsl-gui>announced that they are working on GUI support using Wayland</a> and that it should ship in 2020. So you have to use X11 forwarding or other tricks to enable this - I have tried all of them and there are some issues with any of the solutions:</p><ol><li>X11 server on Windows (<a href=https://sourceforge.net/projects/vcxsrv/>VcXsrv</a> or <a href=https://x410.dev/>X410</a>) and setting the DISPLAY variable in Linux (<code>export DISPLAY=``ip route show | grep 'default via' | awk '{print $3}'``:0.0</code> in your <code>.bashrc</code>).<ul><li>Works quite well - good performance, shortcuts work, even mouse back/forward buttons work as expected</li><li>The main problem is that when you go to standby or hibernate the <a href=https://superuser.com/questions/1474559/wsl2-x11-programs-disappear>connection between Windows and WSL breaks</a> and all your apps stop. If you can live with that go with this solution!</li></ul></li><li>Running <a href=http://xrdp.org/>xrdp</a> on Linux and using Remote Desktop to connect<ul><li>In this case you are running a full desktop - that means you have to install Xfce (Gnome does not seem to work).</li><li>With this solution the whole UI feels a bit laggy and slow - I tried to tune the xrdp params without success.</li></ul></li><li><a href=http://xpra.org/>Xpra</a> - a virtual X11 server to connect via a client on Windows (or other platforms)<ul><li>The solution works but there are many issues like crashes, window positions are completely wrong, extra mouse buttons do not work, etc.</li></ul></li><li><a href=https://wiki.x2go.org/>X2Go</a> - also a virtual X11 server with an Windows client<ul><li>This seems to be the most promising solution</li><li>As with plain X11: good performance, shortcuts work, even mouse back/forward buttons work as expected, plus the reconnect feature</li><li>The only drawback is the quirky Windows client (but I got used to it)</li></ul></li></ol><h3 id=x2go>X2Go</h3><p>Here is the X2Go setup in more details (since it worked best for me).</p><h4 id=initial-setup>Initial setup</h4><ol><li><p>Fix SSH host keys</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt-get remove --purge openssh-server
sudo apt-get install openssh-server
sudo service ssh --full-restart
</code></pre></div></li><li><p>Install X2Go on your Linux distribution</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt install x2goserver
</code></pre></div></li><li><p><a href=http://code.x2go.org/releases/X2GoClient_latest_mswin32-setup.exe>Download</a> and install the client for Windows.</p></li><li><p>Configure the</p><ul><li>Host: <code>localhost</code></li><li>Login: <code>&lt;your user></code></li><li>Session type: Published Applications</li></ul></li></ol><h4 id=after-each-wslwindows-restart>After each WSL/Windows restart</h4><ol><li>Launch ssh in Linux (if not started yet): <code>sudo service ssh start</code></li><li>Launch &ldquo;X2Go Client&rdquo; on Windows ad connect to the server with user/password</li><li>Now you can launch X11 apps via the tray icon (see <a href=https://wiki.x2go.org/doku.php/wiki:advanced:published-applications>X2Go Published Applications</a>)</li></ol><h2 id=install-intellij-idea>Install IntelliJ IDEA</h2><p>TODO</p><h2 id=open-issues>Open Issues</h2><p>TODO</p><h2 id=resources>Resources</h2><ul><li><a href=https://adamtheautomator.com/windows-subsystem-for-linux/ title="Windows Subsystem for Linux (WSL): The Ultimate Guide">Windows Subsystem for Linux (WSL): The Ultimate Guide</a></li><li><a href=https://dev.to/darksmile92/linux-on-windows-wsl-with-desktop-environment-via-rdp-522g>Linux on Windows: WSL with Desktop Environment via RDP</a></li><li><a href=https://eising.wordpress.com/2018/11/05/howto-functional-ubuntu-desktop-on-windows-10-wsl/>HOWTO: Functional Ubuntu desktop on Windows 10/WSL</a></li></ul></article></main></body></html>