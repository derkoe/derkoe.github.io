<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">
	<title>Development Environment in WSL2</title>
	<link rel="stylesheet" href="/css/style.min.d7a3d982f79b1627c97d3aead1d2ab0087ee3196139c34b2f4e2d00c633bfeb2.css" integrity="sha256-16PZgvebFifJfTrq0dKrAIfuMZYTnDSy9OLQDGM7/rI=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://derkoe.github.io/">derkoe</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="/about/">About</a>
					<a href="/talks/">Talks</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://twitter.com/derkoe" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://github.com/derkoe" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast" style="display: none;">
		<ul>
			<li><a href="/about/">About</a></li>
			<li><a href="/talks/">Talks</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Development Environment in WSL2</h1>
		<div class="content">
			<p>This guide shows how to setup a full development environment including UI apps (X11) in WSL2 on Windows 10. WSL2 enables a &ldquo;full&rdquo; Linux development environment in Windows.</p>
<h2 id="why">Why?</h2>
<p>The first thing you might ask is: why? First, we have to run Windows on our machines - so the all-in Linux does not work. Second, Linux is a lot faster for building software than Windows - our biggest app compiles in 13 minutes under Windows and in just 2 minutes under WSL on my machine which is a massive improvement.</p>
<h2 id="enable-wsl2-and-install-ubuntu">Enable WSL2 and Install Ubuntu</h2>
<p>For WSL2 to work you will need a Windows 10 build 19041 (aka 20H1) or higher (any edition will work, even Home). Then simply follow the <a href="https://docs.microsoft.com/en-us/windows/wsl/wsl2-install" title="Windows Subsystem for Linux Installation Guide for Windows 10">guide from Microsoft</a>.</p>
<p><strong>TL;DR:</strong></p>
<ol>
<li>
<p>Enable the features WSL and VM-Platform in Powershell as Admin:</p>
<pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre>
</li>
<li>
<p>Restart Windows</p>
</li>
<li>
<p>Set WSL2 as default:</p>
<pre><code>wsl --set-default-version 2
</code></pre>
</li>
<li>
<p>Go to the Microsoft Store and install &ldquo;Ubuntu&rdquo;</p>
</li>
<li>
<p>Launch Ubuntu from Start menu (this will ask you for a user account)</p>
</li>
</ol>
<p>You can now re-launch a shell in your Ubuntu instance with &ldquo;Ubuntu&rdquo; from the Start menu or execute <code>wsl</code> from the command line. The WSL command line tool has many options which you can find with <code>wsl --help</code> or in the <a href="https://docs.microsoft.com/en-us/windows/wsl/reference">Command Reference</a>.</p>
<h2 id="update-and-install-software">Update and Install Software</h2>
<p>Inside your Ubuntu update all packages:</p>
<pre><code>sudo apt update
sudo apt upgrade
</code></pre>
<p>Then install packages you need for your development - in my case it is Java 11, Maven, Node.js/NPM and git:</p>
<pre><code>sudo apt install openjdk-11-jdk openjdk-11-source maven nodejs npm git
</code></pre>
<h2 id="gui-apps-x11wayland">GUI Apps (X11/Wayland)</h2>
<p>Currently there is no support for GUI apps for WSL - Microsoft has <a href="https://devblogs.microsoft.com/commandline/the-windows-subsystem-for-linux-build-2020-summary/#wsl-gui">announced that they are working on GUI support using Wayland</a> and that it should ship in 2020. So you have to use X11 forwarding or other tricks to enable this - I have tried all of them and there are some issues with any of the solutions:</p>
<ol>
<li>X11 server on Windows (<a href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a> or <a href="https://x410.dev/">X410</a>) and setting the DISPLAY variable in Linux (<code>export DISPLAY=``ip route show | grep 'default via' | awk '{print $3}'``:0.0</code> in your <code>.bashrc</code>).
<ul>
<li>Works quite well - good performance, shortcuts work, even mouse back/forward buttons work as expected</li>
<li>The main problem is that when you go to standby or hibernate the <a href="https://superuser.com/questions/1474559/wsl2-x11-programs-disappear">connection between Windows and WSL breaks</a> and all your apps stop. If you can live with that  go with this solution!</li>
</ul>
</li>
<li>Running <a href="http://xrdp.org/">xrdp</a> on Linux and using Remote Desktop to connect
<ul>
<li>In this case you are running a full desktop - that means you have to install Xfce (Gnome does not seem to work).</li>
<li>With this solution the whole UI feels a bit laggy and slow - I tried to tune the xrdp params without success.</li>
</ul>
</li>
<li><a href="http://xpra.org/">Xpra</a> - a virtual X11 server to connect via a client on Windows (or other platforms)
<ul>
<li>The solution works but there are many issues like crashes, window positions are completely wrong, extra mouse buttons do not work, etc.</li>
</ul>
</li>
<li><a href="https://wiki.x2go.org/">X2Go</a> - also a virtual X11 server with an Windows client
<ul>
<li>This seems to be the most promising solution</li>
<li>As with plain X11: good performance, shortcuts work, even mouse back/forward buttons work as expected, plus the reconnect feature</li>
<li>The only drawback is the quirky Windows client</li>
</ul>
</li>
</ol>
<h3 id="x2go">X2Go</h3>
<p>Here is the X2Go setup in more details (since it worked best for me).</p>
<h4 id="initial-setup">Initial setup</h4>
<ol>
<li>
<p>Fix SSH host keys</p>
<pre><code>sudo apt-get remove --purge openssh-server
sudo apt-get install openssh-server
sudo service ssh --full-restart
</code></pre>
</li>
<li>
<p>Install X2Go on your Linux distribution</p>
<pre><code>apt install x2goserver x2goserver-xsession
</code></pre>
</li>
<li>
<p><a href="http://code.x2go.org/releases/X2GoClient_latest_mswin32-setup.exe">Download</a> and install the client for Windows.</p>
</li>
<li>
<p>Configure the</p>
<ul>
<li>Host: localhost</li>
<li>Login: <!-- raw HTML omitted --></li>
<li>Session type: Published Applications</li>
</ul>
</li>
</ol>
<h4 id="after-each-wslwindows-restart">After each WSL/Windows restart</h4>
<ol>
<li>Launch ssh in Linux (if not started yet): <code>sudo service ssh start</code></li>
<li>Launch &ldquo;X2Go Client&rdquo; on Windows ad connect to the server with user/password</li>
<li>Now you can launch X11 apps via the tray icon (see <a href="https://wiki.x2go.org/doku.php/wiki:advanced:published-applications">X2Go Published Applications</a>)</li>
</ol>
<h2 id="open-issues">Open Issues</h2>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://adamtheautomator.com/windows-subsystem-for-linux/" title="Windows Subsystem for Linux (WSL): The Ultimate Guide">Windows Subsystem for Linux (WSL): The Ultimate Guide</a></li>
<li><a href="https://dev.to/darksmile92/linux-on-windows-wsl-with-desktop-environment-via-rdp-522g">Linux on Windows: WSL with Desktop Environment via RDP</a></li>
<li><a href="https://eising.wordpress.com/2018/11/05/howto-functional-ubuntu-desktop-on-windows-10-wsl/">HOWTO: Functional Ubuntu desktop on Windows 10/WSL</a></li>
</ul>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2020 <a href="https://derkoe.github.io/">Christian KÃ¶berl</a></p>
	</footer>

	<script>let haveHeader = true;</script>

	<script src="/js/main.min.f2521aa6faf4cb65db54424299b38ea82ae5cf9f23001e8548c6f1bdf837e72b.js" integrity="sha256-8lIapvr0y2XbVEJCmbOOqCrlz58jAB6FSMbxvfg35ys="></script>
	
</body>

</html>
